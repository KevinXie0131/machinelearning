Fallback (provides an alternative solution during a service request failure)
circuit breaker
Sharding key / Partition kay
    - Re-sharding data
    - Celebrity problem
    - Join and de-normalization

support millions of users:
    • Keep web tier stateless
    • Build redundancy at every tier
    • Cache data as much as you can
    • Support multiple data centers
    • Host static assets in CDN
    • Scale your data tier by sharding
    • Split tiers into individual services
    • Monitor your system and use automation tools

sorted by reverse chronological order
fanout service (Fan-out is the distribution of messages by a service or message router to multiple users, often simultaneously)
fanout worker

authentication / rate limiting
roll out the system / a recap of your design
------------------------------------------------------------------------------------------------------------------------

throttle rules / rate limiter middleware / malicious actors
API gateway / IP whitelisting
Algorithms for rate limiting
    • Token bucket
        pre-defined capacity
    • Leaking bucket
    • Fixed window counter
    • Sliding window log
    • Sliding window counter

at one minute interval / allows a burst of traffic for short periods
increments the counter by one / reaches the pre-defined threshold
the available quota / remove all the outdated timestamps
rounded up or down

In-memory cache / supports time-based expiration strategy
fetches the counter

two challenges in a distributed environment:
    • Race condition
    • Synchronization issue

gracefully recover from exceptions
------------------------------------------------------------------------------------------------------------------------

Consistent hashing (hash ring / virtual nodes or replicas / redistributed.)
mitigate this problem
------------------------------------------------------------------------------------------------------------------------

Automatic scaling
due to the space constraint
stale data
Data partition / Data replication / Write path / Read path

Data partition
    • Distribute data across multiple servers evenly.
    • Minimize data movement when nodes are added or removed.

Quorum consensus
    Data replication can guarantee consistency for both read and write operations
    If W + R > N, strong consistency is guaranteed because there must be at least one overlapping node that has the latest data to ensure consistency.
        N = The number of replicas
        W = A write quorum of size W
        R = A read quorum of size R

Consistency models:
    • Strong consistency (usually achieved by forcing a replica not to accept new reads/writes until every replica has agreed on current write)
    • Weak consistency
    • Eventual consistency (this is a specific form of weak consistency. Given enough time, all updates are propagated, and all replicas are consistent.)

    Dynamo and Cassandra adopt eventual consistency, which is our recommended consistency model for our key-value store.

Inconsistency resolution: versioning / vector locks
    detect conflicts and reconcile conflicts
    A vector clock is a [server, version] pair associated with a data item

Failure detection
    gossip protocol (decentralized failure detection methods) - node membership list / heartbeat counter

Handling temporary failures
    'sloppy quorum' is used to improve availability (chooses the first W healthy servers for writes and first R healthy servers for reads on the hash ring. Offline servers are ignored)
    hinted handoff (Since s2 is unavailable, reads and writes will be handled by s3 temporarily. When s2 comes back online, s3 will hand the data back to s2)

Handling permanent failures
    anti-entropy protocol
    A hash tree or Merkle tree is used for inconsistency detection and minimizing the amount of data transferred

Bloom filter
------------------------------------------------------------------------------------------------------------------------

generate unique IDs in distributed systems
    • Multi-master replication: database auto_increment feature
    • Universally unique identifier (UUID)
    • Ticket server: centralized auto_increment feature in a single database server (Ticket Server)
    • Twitter snowflake approach

a few additional talking points:
    • Clock synchronization - Network Time Protocol
    • Section length tuning
    • High availability - mission-critical
------------------------------------------------------------------------------------------------------------------------

REST-style APIs / restful API / HTTP redirection / URL redirecting
301 Moved Permanently redirect status response code

301 redirect vs 302 redirect
    - 301 redirect: the browser caches the response, and subsequent requests for the same URL will not be sent to the URL shortening service
    - 302 redirect: subsequent requests for the same URL will be sent to the URL shortening service first

[0-9, a-z, A-Z], containing 10 + 26 + 26 = 62 possible characters.

two types of hash functions for a URL shortener:
    - Hash + collision resolution / bloom filters (a space-efficient probabilistic technique to test if an element is a member of a set.)
    - base 62 conversion
         base 62 is a way of using 62 characters for encoding. The mappings are:
         0-0, ..., 9-9, 10-a, 11-b, ..., 35-z, 36-A, ..., 61-Z, where ‘a’ stands for 10, ‘Z’ stands for 61, etc.

additional talking points:
   • Rate limiter - malicious users / overwhelmingly large number of URL shortening requests
   • Web server scaling - web tier is stateless
   • Database scaling - Database replication and sharding
   • Integrating an analytics solution
   • Availability, consistency, and reliability
------------------------------------------------------------------------------------------------------------------------

A crawler is used for many purposes:
   • Search engine indexing
   • Web archiving
   • Web mining
   • Web monitoring

with duplicate content
the following characteristics:
   • Scalability
   • Robustness
   • Extensibility
Peak QPS = 2 * QPS

Seed URLs / URL Frontier / DNS Resolver / HTML Downloader / Content Parser / Content Seen? / Content Storage / URL Extractor / URL Filter / URL Seen? / URL Storage
potential infinite loops

Depth-first search (DFS) vs Breadth-first search (BFS)
prioritize URLs according to their page ranks, web traffic, update frequency, etc.













